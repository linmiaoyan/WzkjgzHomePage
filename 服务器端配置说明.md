# æœåŠ¡å™¨ç«¯ Git é…ç½®è¯´æ˜

## ğŸ“‹ åœ¨æœåŠ¡å™¨ä¸Šé…ç½® Git ä»“åº“

### æ­¥éª¤1ï¼šSSHè¿æ¥åˆ°æœåŠ¡å™¨

```bash
ssh root@your-server-ip
```

### æ­¥éª¤2ï¼šåˆ›å»º Git ä»“åº“ç›®å½•

```bash
# åˆ›å»ºGitä»“åº“å­˜å‚¨ç›®å½•
mkdir -p /var/git
cd /var/git
```

### æ­¥éª¤3ï¼šåˆå§‹åŒ–è£¸ä»“åº“

```bash
# åˆ›å»ºè£¸ä»“åº“ï¼ˆbare repositoryï¼‰
git init --bare WzkjHomepage.git

# è®¾ç½®æƒé™ï¼ˆæ ¹æ®ä½ çš„WebæœåŠ¡å™¨ç”¨æˆ·è°ƒæ•´ï¼‰
# å¦‚æœæ˜¯ nginx/apacheï¼Œé€šå¸¸æ˜¯ www-data
chown -R www-data:www-data WzkjHomepage.git

# æˆ–è€…å¦‚æœæ˜¯ root è¿è¡Œ
# chown -R root:root WzkjHomepage.git
```

### æ­¥éª¤4ï¼šé…ç½®é¡¹ç›®å·¥ä½œç›®å½•

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•ï¼ˆä½ çš„å®é™…é¡¹ç›®è·¯å¾„ï¼‰
cd /var/www/WzkjHomepage  # æˆ– /home/www/WzkjHomepage ç­‰

# å¦‚æœç›®å½•ä¸å­˜åœ¨ï¼Œåˆ›å»ºå®ƒ
mkdir -p /var/www/WzkjHomepage
cd /var/www/WzkjHomepage

# å…‹éš†ä»£ç ï¼ˆé¦–æ¬¡ï¼‰
git clone /var/git/WzkjHomepage.git .

# å¦‚æœç›®å½•å·²ç»æœ‰æ–‡ä»¶ï¼Œåˆå§‹åŒ–Gitå¹¶æ·»åŠ è¿œç¨‹ä»“åº“
# git init
# git remote add origin /var/git/WzkjHomepage.git
# git pull origin main
```

### æ­¥éª¤5ï¼šé…ç½®è‡ªåŠ¨éƒ¨ç½²ï¼ˆå¯é€‰ä½†æ¨èï¼‰

```bash
# è¿›å…¥Gitä»“åº“
cd /var/git/WzkjHomepage.git

# åˆ›å»º post-receive hook
cat > hooks/post-receive << 'EOF'
#!/bin/bash
WORK_TREE=/var/www/WzkjHomepage
GIT_DIR=/var/git/WzkjHomepage.git

cd $WORK_TREE || exit
unset GIT_DIR
git checkout -f

# è®¾ç½®æ–‡ä»¶æƒé™
chown -R www-data:www-data $WORK_TREE
chmod -R 755 $WORK_TREE

# é‡å¯æœåŠ¡ï¼ˆæ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ï¼‰
# systemctl restart wzkjhomepage
# æˆ– supervisorctl restart wzkjhomepage
# æˆ–ä½¿ç”¨å…¶ä»–æ–¹å¼é‡å¯

echo "éƒ¨ç½²å®Œæˆï¼"
EOF

# è®¾ç½®æ‰§è¡Œæƒé™
chmod +x hooks/post-receive
```

**é…ç½®åï¼Œæ¯æ¬¡ä»æœ¬åœ°æ¨é€ä»£ç åˆ°æœåŠ¡å™¨æ—¶ï¼Œä¼šè‡ªåŠ¨éƒ¨ç½²ï¼**

---

## ğŸ”„ åœ¨æœåŠ¡å™¨ä¸Šæ›´æ–°ä»£ç 

### æ–¹å¼1ï¼šè‡ªåŠ¨éƒ¨ç½²ï¼ˆå·²é…ç½®hookï¼‰

æ¨é€ä»£ç åä¼šè‡ªåŠ¨éƒ¨ç½²ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œã€‚

### æ–¹å¼2ï¼šæ‰‹åŠ¨æ‹‰å–

```bash
# SSHè¿æ¥åˆ°æœåŠ¡å™¨
ssh root@your-server-ip

# è¿›å…¥é¡¹ç›®ç›®å½•
cd /var/www/WzkjHomepage

# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# æˆ–ä»è¿œç¨‹ä»“åº“æ‹‰å–
git pull server main

# é‡å¯æœåŠ¡
systemctl restart wzkjhomepage
# æˆ–
supervisorctl restart wzkjhomepage
```

---

## ğŸ” SSH å¯†é’¥é…ç½®

### åœ¨æœ¬åœ°ç”ŸæˆSSHå¯†é’¥ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰

```bash
# Windows PowerShell æˆ– CMD
ssh-keygen -t rsa -b 4096

# æŒ‰æç¤ºæ“ä½œï¼Œå¯ä»¥ç›´æ¥å›è½¦ä½¿ç”¨é»˜è®¤è·¯å¾„
# å¯ä»¥è®¾ç½®å¯†ç æˆ–ç•™ç©º
```

### å¤åˆ¶å…¬é’¥åˆ°æœåŠ¡å™¨

```bash
# æ–¹æ³•1ï¼šä½¿ç”¨ ssh-copy-idï¼ˆæ¨èï¼Œå¦‚æœå¯ç”¨ï¼‰
ssh-copy-id root@your-server-ip

# æ–¹æ³•2ï¼šæ‰‹åŠ¨å¤åˆ¶
# 1. æŸ¥çœ‹å…¬é’¥å†…å®¹
type %USERPROFILE%\.ssh\id_rsa.pub

# 2. å¤åˆ¶è¾“å‡ºçš„å†…å®¹

# 3. SSHåˆ°æœåŠ¡å™¨
ssh root@your-server-ip

# 4. æ·»åŠ åˆ° authorized_keys
mkdir -p ~/.ssh
echo "ç²˜è´´ä½ çš„å…¬é’¥å†…å®¹" >> ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys
chmod 700 ~/.ssh
```

### æµ‹è¯•è¿æ¥

```bash
# æµ‹è¯•SSHè¿æ¥ï¼ˆåº”è¯¥ä¸éœ€è¦å¯†ç ï¼‰
ssh root@your-server-ip

# æµ‹è¯•Gitè¿æ¥
git ls-remote root@your-server-ip:/var/git/WzkjHomepage.git
```

---

## ğŸ“ å®Œæ•´é…ç½®ç¤ºä¾‹

å‡è®¾æœåŠ¡å™¨IPæ˜¯ `192.168.1.100`ï¼Œé¡¹ç›®è·¯å¾„æ˜¯ `/var/www/WzkjHomepage`

### æœåŠ¡å™¨ç«¯æ“ä½œ

```bash
# 1. SSHè¿æ¥
ssh root@192.168.1.100

# 2. åˆ›å»ºGitä»“åº“
mkdir -p /var/git
cd /var/git
git init --bare WzkjHomepage.git

# 3. è®¾ç½®æƒé™
chown -R www-data:www-data WzkjHomepage.git

# 4. é…ç½®é¡¹ç›®ç›®å½•
mkdir -p /var/www/WzkjHomepage
cd /var/www/WzkjHomepage
git clone /var/git/WzkjHomepage.git .

# 5. é…ç½®è‡ªåŠ¨éƒ¨ç½²
cd /var/git/WzkjHomepage.git
cat > hooks/post-receive << 'EOF'
#!/bin/bash
cd /var/www/WzkjHomepage
git checkout -f
chown -R www-data:www-data /var/www/WzkjHomepage
systemctl restart wzkjhomepage 2>/dev/null || true
EOF
chmod +x hooks/post-receive
```

### æœ¬åœ°æ“ä½œ

```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd D:\OneDrive\09æ•™è‚²æŠ€æœ¯å¤„\WzkjHomepage

# 2. åˆå§‹åŒ–Gitï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
git init
git add .
git commit -m "Initial commit"

# 3. æ·»åŠ è¿œç¨‹ä»“åº“
git remote add server root@192.168.1.100:/var/git/WzkjHomepage.git

# 4. æ¨é€ä»£ç 
git branch -M main
git push -u server main
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ–‡ä»¶æƒé™**
   - ç¡®ä¿WebæœåŠ¡å™¨ç”¨æˆ·æœ‰è¯»å†™æƒé™
   - ä¸Šä¼ ç›®å½•éœ€è¦å†™æƒé™

2. **æ•°æ®åº“æ–‡ä»¶**
   - æ•°æ®åº“æ–‡ä»¶ä¸ä¼šè¢«Gitç®¡ç†ï¼ˆå·²åœ¨.gitignoreä¸­ï¼‰
   - éƒ¨ç½²ä¸ä¼šè¦†ç›–æ•°æ®åº“

3. **æœåŠ¡é‡å¯**
   - æ ¹æ®ä½ çš„éƒ¨ç½²æ–¹å¼è°ƒæ•´é‡å¯å‘½ä»¤
   - å¯ä»¥æ˜¯ systemdã€supervisor æˆ–å…¶ä»–æ–¹å¼

4. **å¤‡ä»½**
   - é‡è¦éƒ¨ç½²å‰å»ºè®®å¤‡ä»½æ•°æ®åº“
   - ä½¿ç”¨Gitå¯ä»¥è½»æ¾å›æ»šä»£ç 

---

## ğŸ†˜ å¸¸è§é—®é¢˜

### Q: æ¨é€æ—¶æç¤ºæƒé™è¢«æ‹’ç»

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# æ£€æŸ¥æœåŠ¡å™¨ä»“åº“æƒé™
ls -la /var/git/WzkjHomepage.git

# ç¡®ä¿æœ‰å†™æƒé™
chown -R www-data:www-data /var/git/WzkjHomepage.git
```

### Q: è‡ªåŠ¨éƒ¨ç½²åæ–‡ä»¶æƒé™ä¸å¯¹

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# åœ¨ post-receive hook ä¸­æ·»åŠ æƒé™è®¾ç½®
chown -R www-data:www-data $WORK_TREE
chmod -R 755 $WORK_TREE
```

### Q: å¦‚ä½•å›é€€åˆ°ä¹‹å‰çš„ç‰ˆæœ¬

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# åœ¨æœåŠ¡å™¨ä¸Š
cd /var/www/WzkjHomepage
git log  # æŸ¥çœ‹å†å²
git reset --hard <commit-hash>  # å›é€€
```

